<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; font-style:italic; color:#000000;">Сетевая файловая система</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> – это сетевая абстракция поверх обычной файловой системы, позволяющая удаленному клиенту обращаться к ней через сеть так же, как и при доступе к локальным файловым системам. Хотя NFS не является первой сетевой системой, она сегодня развилась до уровня наиболее функциональной и востребованной сетевой файловой системы в UNIX®. NFS позволяет организовать совместный доступ к общей файловой системе для множества пользователей и обеспечить централизацию данных для минимизации дискового пространства, необходимого для их хранения.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Эта статья начинается с краткого обзора истории NFS, а затем переходит к исследованию архитектуры NFS и путей её дальнейшего развития.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="short_history"></a><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">К</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">раткая история NFS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Первая сетевая файловая система называлась FAL (File Access Listener - обработчик доступа к файлам) и была разработана в 1976 году компанией DEC (Digital Equipment Corporation). Она являлась реализацией протокола DAP (Data Access Protocol – протокол доступа к данным) и входила в пакет протоколов DECnet. Как и в случае с TCP/IP, компания DEC опубликовала спецификации своих сетевых протоколов, включая протокол DAP.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">NFS была первой современной сетевой файловой системой, построенной поверх протокола IP. Её прообразом можно считать экспериментальную файловую систему, разработанную в Sun Microsystems в начале 80-х годов. Учитывая популярность этого решения, протокол NFS был представлен в качестве спецификации RFC и впоследствии развился в NFSv2. NFS быстро утвердилась в качестве стандарта благодаря способности взаимодействовать с другими клиентами и серверами.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Впоследствии стандарт был обновлен до версии NFSv3, определенной в RFC 1813. Эта версия протокола была более масштабируема, чем предыдущие, и поддерживала файлы большего размера (более 2 ГБ), асинхронную запись и TCP в качестве транспортного протокола. NFSv3 задала направление развития файловых систем для глобальных (WAN) сетей. В 2000 году в рамках спецификации RFC 3010 (переработанной в версии RFC 3530) NFS была перенесена в корпоративную среду. Sun представила более защищенную NFSv4 c поддержкой сохранения состояния (stateful) (предыдущие версии NFS не поддерживали сохранение состояния, т.е. относились к категории stateless). На текущий момент последней версией NFS является версия 4.1, определенная в RFC 5661, в которой в протокол посредством расширения</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> </span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">pNFS</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> была добавлена поддержка параллельного доступа для распределенных серверов.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">История развития NFS, включая конкретные RFC, описывающие её версии, показана на рисунке 1.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image16220.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="fig1"></a><span style=" font-family:'arial,sans-serif'; font-size:medium; font-weight:600; color:#000000; background-color:#ffffff;">Р</span><span style=" font-family:'arial,sans-serif'; font-size:medium; font-weight:600; color:#000000; background-color:#ffffff;">исунок 1. История развития NFS</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000; background-color:#ffffff;">  </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-size:medium; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Как ни удивительно, NFS находится в стадии разработки уже почти 30 лет. Она является исключительно стабильной и переносимой сетевой файловой системой с выдающимися характеристиками масштабируемости, производительности и качества обслуживания. В условиях увеличения скорости и снижения задержек при обмене данными внутри сети NFS продолжает оставаться популярным способом реализации файловой системы внутри сети. Даже в случае локальных сетей виртуализация побуждает хранить данные в сети, чтобы обеспечить виртуальным машинам дополнительную мобильность. NFS также поддерживает новейшие модели организации вычислительных сред, нацеленные на оптимизацию виртуальных инфраструктур.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="architecture"></a><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">А</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">рхитектура NFS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">NFS использует стандартную архитектурную модель &quot;клиент-сервер&quot; (как показано на рисунке 2). Сервер отвечает за реализацию файловой системы совместного доступа и хранилища, к которому подключаются клиенты. Клиент реализует пользовательский интерфейс к общей файловой системе, смонтированной внутри локального файлового пространства клиента.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image14706.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="fig2"></a><span style=" font-family:'arial,sans-serif'; font-size:medium; font-weight:600; color:#000000; background-color:#ffffff;">Р</span><span style=" font-family:'arial,sans-serif'; font-size:medium; font-weight:600; color:#000000; background-color:#ffffff;">исунок 2. Реализация модели &quot;клиент-сервер&quot; в архитектуре NFS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000; background-color:#ffffff;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">В ОС Linux® виртуальный коммутатор файловой системы (virtual file system switch - VFS) предоставляет средства для одновременной поддержки на одном хосте нескольких файловых систем (например, файловой системы ISO 9660 на CD-ROM и файловой системы ext3fs на локальном жестком диске). Виртуальный коммутатор определяет, к какому накопителю выполняется запрос, и, следовательно, какая файловая система должна использоваться для обработки запроса. Поэтому NFS обладает такой же совместимостью, как и другие файловые системы, применяющиеся в Linux. Единственное отличие NFS состоит в том, что запросы ввода/вывода вместо локальной обработки на хосте могут быть направлены для выполнения в сеть.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">VFS определяет, что полученный запрос относится к NFS, и передает его в обработчик NFS, находящийся в ядре. Обработчик NFS обрабатывает запрос ввода/вывода и транслирует его в NFS-процедуру (</span><span style=" font-family:'monospace'; font-size:small; color:#000000;">OPEN</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">ACCESS</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">CREATE</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">READ</span><span style=" font-family:'arial,sans-serif'; color:#000000;">,</span><span style=" font-family:'monospace'; font-size:small; color:#000000;">CLOSE</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">REMOVE</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> и т.д.). Эти процедуры, описанные в отдельной спецификации RFC, определяют поведение протокола NFS. Необходимая процедура выбирается в зависимости от запроса и выполняется с помощью технологии RPC (вызов удаленной процедуры). Как можно понять по названию, RPC позволяет осуществлять вызовы процедур между различными системами. RPC-служба соединяет NFS-запрос с его аргументами и отправляет результат на соответствующий удаленный хост, а затем следит за получением и обработкой ответа, чтобы вернуть его инициатору запроса.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Также RPC включает в себя важный уровень XDR (</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">external data representation</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> – независимое представление данных), гарантирующий, что все пользователи NFS для одинаковых типов данных используют один и тот же формат. Когда некая платформа отправляет запрос, используемый ею тип данных может отличаться от типа данных, используемого на хосте, обрабатывающего этот запрос. Технология XDR берет на себя работу по преобразованию типов в стандартное представление (XDR), так что платформы, использующие разные архитектуры, могут взаимодействовать и совместно использовать файловые системы. В XDR определен битовый формат для таких типов, как </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">float</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, и порядок байтов для таких типов, как массивы постоянной и переменной длины. Хотя XDR в основном известна благодаря применению в NFS, это спецификация может быть полезна во всех случаях, когда приходится работать в одной среде с различными архитектурами.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">После того как XDR переведет данные в стандартное представление, запрос передается по сети с помощью определенного транспортного протокола. В ранних реализациях NFS использовался протокол UDP, но сегодня для обеспечения большей надежности применяется протокол TCP.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">На стороне NFS-сервера применяется схожий алгоритм. Запрос поднимается по сетевому стеку через уровень RPC/XDR (для преобразования типов данных в соответствии с архитектурой сервера) и попадает в NFS-сервер, который отвечает за обработку запроса. Там запрос передается NFS-демону для определения целевой файловой системы, которой он адресован, а затем снова поступает в VFS для обращения к этой файловой системе на локальном диске. Полностью схема этого процесса приведена на рисунке 3. При этом локальная файловая система сервера – это стандартная для Linux файловая система, например, ext4fs. По сути NFS – это не файловая система в традиционном понимании этого термина, а протокол удаленного доступа к файловым системам.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image1094.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="fig3"></a><span style=" font-family:'arial,sans-serif'; font-size:medium; font-weight:600; color:#000000; background-color:#ffffff;">Р</span><span style=" font-family:'arial,sans-serif'; font-size:medium; font-weight:600; color:#000000; background-color:#ffffff;">исунок 3. Схема взаимодействия между NFS-клиентом и NFS-сервером</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000; background-color:#ffffff;">   </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Times New Roman'; font-size:medium; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Для сетей с большим временем ожидания в NFSv4 предлагается специальная составная процедура (</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">compound procedure</span><span style=" font-family:'arial,sans-serif'; color:#000000;">). Эта процедура позволяет поместить несколько RPC-вызовов внутрь одного запроса, чтобы минимизировать затраты на передачу запросов по сети. Также в этой процедуре реализован механизм callback-функций для получения ответов.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a href="http://www.ibm.com/developerworks/ru/library/l-network-filesystems/index.html?ca=drs-#ibm-pcon"><span style=" font-family:'arial,sans-serif'; font-weight:600; text-decoration: underline; color:#4c6e94;">В начало</span></a></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'arial,sans-serif'; font-weight:600; text-decoration: underline; color:#4c6e94; background-color:#ffffff;"></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'arial,sans-serif'; font-weight:600; text-decoration: underline; color:#4c6e94; background-color:#ffffff;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="protocol"></a><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">П</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">ротокол NFS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Когда клиент начинает работать с NFS, первым действием выполняется операция</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">mount</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, которая представляет собой монтирование удаленной файловой системы в пространство локальной файловой системы. Этот процесс начинается с вызова процедуры </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">mount</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> (одной из системных функций Linux), который через VFS перенаправляется в NFS-компонент. Затем с помощью RPC-вызова функции </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">get_port</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> на удаленном сервере определяется номер порта, который будет использоваться для монтирования, и клиент через RPC отправляет запрос на монтирование. Этот запрос на стороне сервера обрабатывается специальным демоном </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">rpc.mountd</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, отвечающим за протокол монтирования (</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">mount protocol</span><span style=" font-family:'arial,sans-serif'; color:#000000;">). Демон проверяет, что запрошенная клиентом файловая система имеется в списке систем, доступных на данном сервере. Если запрошенная система существует и клиент имеет к ней доступ, то в ответе RPC-процедуры </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">mount</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> указывается дескриптор файловой системы. Клиент сохраняет у себя информацию о локальной и удаленной точках монтирования и получает возможность осуществлять запросы ввода/вывода. Протокол монтирования не является безупречным с точки зрения безопасности, поэтому в NFSv4 вместо него используются внутренние RPC-вызовы, которые также могут управлять точками монтирования.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Для считывания файла его необходимо сначала открыть. В RPC нет процедуры</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">OPEN</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, вместо этого клиент просто проверяет, что указанные файл и каталог существуют в смонтированной файловой системе. Клиент начинает с выполнения RPC-запроса </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">GETATTR</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> к каталогу, в ответ на который возвращаются атрибуты каталога или индикатор, что каталог не существует. Далее, чтобы проверить наличие файла, клиент выполняет RPC-запрос </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">LOOKUP</span><span style=" font-family:'arial,sans-serif'; color:#000000;">. Если файл существует, для него выполняется RPC-запрос </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">GETATTR</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, чтобы узнать атрибуты файла. Используя информацию, полученную в результате успешных вызовов </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">LOOKUP</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> и </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">GETATTR</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, клиент создает дескриптор файла, который предоставляется пользователю для выполнения будущих запросов.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">После того как файл идентифицирован в удаленной файловой системе, клиент может выполнять RPC-запросы типа</span><span style=" font-family:'monospace'; font-size:small; color:#000000;">READ</span><span style=" font-family:'arial,sans-serif'; color:#000000;">. Этот запрос состоит из дескриптора файла, состояния, смещения и количества байт, которое следует считать. Клиент использует состояние (</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">state</span><span style=" font-family:'arial,sans-serif'; color:#000000;">), чтобы определить может ли операция быть выполнена в данный момент, т.е. не заблокирован ли файл. Смещение (</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">offset</span><span style=" font-family:'arial,sans-serif'; color:#000000;">) указывает, с какой позиции следует начать чтение, а счетчик байт (</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">count</span><span style=" font-family:'arial,sans-serif'; color:#000000;">) определяет, сколько байт необходимо считать. В результате RPC-вызова </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">READ</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> сервер не всегда возвращает столько байт, сколько было запрошено, но вместе с возвращаемыми данными всегда передает, сколько байт было отправлено клиенту.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="innovation"></a><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">И</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">нновации в NFS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Наибольший интерес представляют две последние версии NFS – 4 и 4.1, на примере которых можно изучить наиболее важные аспекты эволюции технологии NFS.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">До появления NFSv4 для выполнения таких задач по управлению файлами, как монтирование, блокировка и т.д. существовали специальные дополнительные протоколы. В NFSv4 процесс управления файлами был упрощен до одного протокола; кроме того, начиная с этой версии UDP больше не используется в качестве транспортного протокола. NFSv4 включает поддержку UNIX и Windows®-семантики доступа к файлам, что позволяет NFS &quot;естественным&quot; способом интегрироваться в другие операционные системы.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">В NFSv4.1 для большей масштабируемости и производительности была введена концепция</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> </span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">параллельной NFS</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> (parallel NFS - pNFS). Чтобы обеспечить больший уровень масштабируемости, в NFSv4.1 реализована архитектура, в которой данные и метаданные (</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">разметка</span><span style=" font-family:'arial,sans-serif'; color:#000000;">) распределяются по устройствам аналогично тому, как это делается в кластерных файловых системах. Как показано на </span><a href="http://www.ibm.com/developerworks/ru/library/l-network-filesystems/index.html?ca=drs-#fig4"><span style=" font-family:'arial,sans-serif'; text-decoration: underline; color:#4c6e94;">рисунке 4</span></a><span style=" font-family:'arial,sans-serif'; color:#000000;">, pNFS разделяет экосистему на три составляющие: клиент, сервер и хранилище. При этом появляются два канала: один для передачи данных, а другой для передачи команд управления. pNFS отделяет данные от описывающих их метаданных, обеспечивая двухканальную архитектуру. Когда клиент хочет получить доступ к файлу, сервер отправляет ему метаданные с &quot;разметкой&quot;. В метаданных содержится информация о размещении файла на запоминающих устройствах. Получив эту информацию, клиент может обращаться напрямую к хранилищу без необходимости взаимодействовать с сервером, что способствует повышению масштабируемости и производительности. Когда клиент заканчивает работу с файлом, он подтверждает изменения, внесенные в файл и его &quot;разметку&quot;. При необходимости сервер может запросить у клиента метаданные с разметкой.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">С появлением pNFS в протокол NFS было добавлено несколько новых операций для поддержки такого механизма. Метод</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">LayoutGet</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> используется для получения метаданных с сервера, метод </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">LayoutReturn</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> &quot;освобождает&quot; метаданные, &quot;захваченные&quot; клиентом, а метод </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">LayoutCommit</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> загружает &quot;разметку&quot;, полученную от клиента, в хранилище, так что она становится доступной другим пользователям. Сервер может отозвать метаданные у клиента с помощью метода</span><span style=" font-family:'monospace'; font-size:small; color:#000000;">LayoutRecall</span><span style=" font-family:'arial,sans-serif'; color:#000000;">. Метаданные с &quot;разметкой&quot; распределяются между несколькими запоминающими устройствами, чтобы обеспечить параллельный доступ и высокую производительность.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><img src="image565.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="fig4"></a><span style=" font-family:'arial,sans-serif'; font-size:medium; font-weight:600; color:#000000; background-color:#ffffff;">Р</span><span style=" font-family:'arial,sans-serif'; font-size:medium; font-weight:600; color:#000000; background-color:#ffffff;">исунок 4. Архитектура pNFS в NFS версии 4.1</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000; background-color:#ffffff;">  </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Данные и метаданные хранятся на запоминающих устройствах. Клиенты могут выполнять прямые запросы ввода/вывода на основе полученной</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">разметки</span><span style=" font-family:'arial,sans-serif'; color:#000000;">, а сервер NFSv4.1 хранит метаданные и управляет ими. Сама по себе эта функциональность и не нова, но в pNFS была добавлена поддержка различных методов доступа к запоминающим устройствам. Сегодня pNFS поддерживает использование блочных протоколов (Fibre Channel), объектных протоколов и собственно NFS (даже не в pNFS-форме).</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Развитие NFS продолжается, и в сентябре 2010 года были опубликованы требования к NFSv4.2. Некоторые из нововведений связаны с наблюдающейся миграцией технологий хранения данных в сторону виртуализации. Например, в виртуальных средах с гипервизором весьма вероятно возникновение дублирования данных (несколько ОС выполняют чтение/запись и кэширование одних и тех же данных). В связи с этим желательно, чтобы система хранения данных в целом понимала, где происходит дублирование. Такой подход поможет сэкономить пространство в кэше клиента и общую емкость системы хранения. В NFSv4.2 для решения этой проблемы предлагается использовать &quot;карту блоков, находящихся в совместном доступе&quot; (</span><span style=" font-family:'monospace'; font-size:small; color:#000000;">block map of shared blocks</span><span style=" font-family:'arial,sans-serif'; color:#000000;">). Поскольку современные системы хранения все чаще оснащаются собственными внутренними вычислительными мощностями, вводится копирование на стороне сервера, позволяющее снизить нагрузку при копировании данных во внутренней сети, когда это можно эффективно делать на самом запоминающем устройстве. Другие инновации включают в себя субфайловое кэширование для флэш-памяти и рекомендации по настройке ввода-вывода на стороне клиента (например, с использованием </span><span style=" font-family:'monospace'; font-size:small; color:#000000;">mapadvise</span><span style=" font-family:'arial,sans-serif'; color:#000000;">).</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="alternatives"></a><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">А</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">льтернативы NFS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Хотя NFS – самая популярная сетевая файловая система в UNIX и Linux, кроме нее существуют и другие сетевые файловые системы. На платформе Windows® чаще всего применяется SMB, также известная как</span><span style=" font-family:'arial,sans-serif'; color:#000000;"> </span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">CIFS</span><span style=" font-family:'arial,sans-serif'; color:#000000;">; при этом ОС Windows также поддерживает NFS, равно как и Linux поддерживает SMB.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Одна из новейших распределенных файловых систем, поддерживаемых в Linux - Ceph - изначально спроектирована как отказоустойчивая POSIX-совместимая файловая система. Дополнительную информацию о Ceph можно найти в разделе</span><a href="http://www.ibm.com/developerworks/ru/library/l-network-filesystems/index.html?ca=drs-#resources"><span style=" font-family:'arial,sans-serif'; text-decoration: underline; color:#4c6e94;">Ресурсы</span></a><span style=" font-family:'arial,sans-serif'; color:#000000;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Стоит также упомянуть файловые системы OpenAFS (Open Source-версия распределенной файловой системы Andrew, разработанной в университете Карнеги-Меллона и корпорации IBM), GlusterFS (распределенная файловая система общего назначения для организации масштабируемых хранилищ данных) и Lustre (сетевая файловая система с массовым параллелизмом для кластерных решений). Все эти системы с открытым исходным кодом можно использовать для построения распределенных хранилищ.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="N101BB"></a><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">З</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">аключение</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'arial,sans-serif'; color:#000000; background-color:#ffffff;">Развитие файловой системы NFS продолжается. Подобно ОС Linux, подходящей для поддержки и бюджетных, и встраиваемых, и высокопроизводительных решений, NFS предоставляет архитектуру масштабируемых решений для хранения данных, подходящих как отдельным пользователям, так и организациям. Если посмотреть на путь, уже пройденный NFS, и перспективы её дальнейшего развития, становится понятно, что эта файловая система будет продолжать изменять наши взгляды на то, как реализуются и используются технологии хранения файлов.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="resources"></a><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">Р</span><span style=" font-family:'arial,sans-serif'; font-weight:600; color:#000000;">есурсы</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'arial,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.ibm.com/developerworks/linux/library/l-network-filesystems/index.html?S_TACT=105AGX99&amp;S_CMP=CP"><span style=" text-decoration: underline; color:#4c6e94;">Network file systems and Linux (http://www.ibm.com/developerworks/linux/library/l-network-filesystems/index.html?S_TACT=105AGX99&amp;S_CMP=CP)</span></a>: оригинал статьи (EN).</li>
<li style=" font-family:'arial,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">NFS – это стандарт спецификации переносимой и мультиплатформенной сетевой файловой системы. NFS документирована в нескольких спецификациях, включая первую реализацию <a href="http://www.faqs.org/rfcs/rfc1094.html"><span style=" text-decoration: underline; color:#4c6e94;">NFSv2</span></a>, <a href="http://www.faqs.org/rfcs/rfc1813.html"><span style=" text-decoration: underline; color:#4c6e94;">NFSv3</span></a>, <a href="http://www.faqs.org/rfcs/rfc3530.html"><span style=" text-decoration: underline; color:#4c6e94;">NFSv4</span></a> и новейшую версию <a href="http://www.faqs.org/rfcs/rfc5661.html"><span style=" text-decoration: underline; color:#4c6e94;">NFSv4.1</span></a>. О направлении дальнейшего развития NFS можно узнать в <a href="https://tools.ietf.org/html/draft-ietf-nfsv4-minorversion-2-requirements-00"><span style=" text-decoration: underline; color:#4c6e94;">требованиях к NFS v4.2</span></a>.</li>
<li style=" font-family:'arial,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://yanfs.dev.java.net/"><span style=" text-decoration: underline; color:#4c6e94;">Yet Another NFS (YANFS)</span></a> – проект компании Sun, ранее называвшийся <a href="http://blogs.sun.com/shepler/entry/yanfs_is_the_new_webnfs"><span style=" text-decoration: underline; color:#4c6e94;">WebNFS</span></a>. Файловая система YANFS – это Java™-реализация NFSv3 и RPC/XDR для организации доступа к NFS из Java-приложений.</li>
<li style=" font-family:'arial,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="http://www.ietf.org/rfc/rfc1832.txt"><span style=" text-decoration: underline; color:#4c6e94;">XDR</span></a> – это стандарт кодирования данных, позволяющий хостам с различной архитектурой общаться по сети с использованием стандартных типов данных.</li>
<li style=" font-family:'arial,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Linux поддерживает различные файловые системы для множества запоминающих устройств. Эта возможность обеспечивается с помощью интеграции различных файловых систем, драйверов для запоминающих устройств и VFS. Дополнительную информацию о VFS можно найти в статье &quot;<a href="http://www.ibm.com/developerworks/ru/library/l-linux-filesystem/index.html"><span style=" text-decoration: underline; color:#4c6e94;">Anatomy of the Linux File System</span></a>&quot; (developerWorks, октябрь 2007 г.).</li>
<li style=" font-family:'arial,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Кроме NFS, существуют и другие способы построить сетевое файловое хранилище. Также можно использовать файловые системы <a href="http://www.openafs.org/"><span style=" text-decoration: underline; color:#4c6e94;">OpenAFS</span></a>, <a href="http://www.gluster.org/"><span style=" text-decoration: underline; color:#4c6e94;">GlusterFS</span></a>, <a href="http://wiki.lustre.org/index.php/Main_Page"><span style=" text-decoration: underline; color:#4c6e94;">Lustre</span></a> и <a href="http://ceph.newdream.net/"><span style=" text-decoration: underline; color:#4c6e94;">Ceph</span></a>. Дополнительную информацию о Ceph можно найти в статье <a href="http://www.ibm.com/developerworks/linux/library/l-ceph/index.html?S_TACT=105AGX99&amp;S_CMP=CP"><span style=" text-decoration: underline; color:#4c6e94;">Ceph: A Linux petabyte-scale distributed file system</span></a>&quot; (developerWorks, май 2010 г.).<br /></li></ul></body></html>