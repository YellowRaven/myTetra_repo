<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Когда стали широко использоваться алгоритмы шифрования при передаче данных в сети, одной из первых задач стала организация безопасной оболочки. До этого существовала система rsh, которая позволяла определенным пользователям с определенных машин (между ними должны были быть доверительные отношения) работать на сервере с его оболочкой. Это практически то же самое, что и telnet-доступ. Но с развитием сетей стали видны вопиющие дыры rsh:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Times New Roman'; font-size:medium; color:#000000;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">данные, передаваемые через сеть, никак не шифруются, включая пароли;</span></li>
<li style=" font-family:'Times New Roman'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">жанные, передаваемые через сеть, могут быть без проблем получены либо модифицированы третьей стороной;</span></li>
<li style=" font-family:'Times New Roman'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">злоумышленник мог спокойно подменить IP клиента и, использовав полученный ранее хеш пароля, пройти аутентификацию на сервере со всеми вытекающими последствиями.</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Поэтому сейчас rsh применяется в чрезвычайно редких случаях, например, при переносе данных между двумя попарно соединенными машинами (мне так пришлось работать с двумя машинами в разных комнатах). В основном стандартом де-факто стал ssh. Первая буква &quot;s&quot; означает безопасный (secure), что означает, что все данные, предаваемые через ssh шифруются, а значит, защищены от просмотра. Существует несколько версий протокола ssh, различающиеся используемыми алгоритмами шифрования и общими схемами работы. В настоящее время повсеместно используется протокол ssh версии два. Протокол младших версий является по современным меркам небезопасным (там есть несколько очень опасных дыр). Вообще-то сейчас ssh является коммерческим продуктом (что само по себе противоречит требованиям безопасности - всем должен быть известен исходный код системы защиты информации, чтобы убедиться в отсутствии всяких backdoors), но тем не менее доступна свободная реализация ssh - OpenSSH, которая может быть найдена на www.openssh.com. Наилучшим документом по ssh является, по-моему, банальный </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">man ssh</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, поэтому в некоторых местах я не постесняюсь его просто переводить.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Итак, начнем, как обычно, с теории. SSH предоставляет 3 способа аутентификации клиента: по ip адресу клиента (небезопасно), по публичному ключу клиента и стандартный парольный метод. Вот как работает ssh версии 2: при запросе клиента сервер сообщает ему, какие методы аутентификации он поддерживает (это определяется в опции PreferredAuthentications sshd.conf) и клиент по очереди пытается проверить их. По умолчанию клиент вначале пытается аутентифицироваться своим адресом, затем публичным ключом и, если ничего не сработало, передает пароль, введенный с клавиатуры (при этом пароль шифруется асимметрическим шифрованием). После прохождения аутентификации одним из методов из имеющихся у клиента и сервера пар ключей генерируется ключ симметрического шифрования, который, как я описывал во введении, генерируется на основании своего секретного и удаленного публичного ключей. После чего все последующие данные, передаваемые через ssh, шифруются данным ключом (обычно используется алгоритм aes с длиной ключа 128 бит). Отмечу, что протокол ssh версии 1 имел некоторые баги в шифрации передаваемого трафика и являлся по сути методом безопасной аутентификации, поэтому по современным меркам данный протокол считается небезопасным. Протокол версии 2 поддерживает более современные методы шифрования тарфика, также вместе с данными посылаются контрольные суммы формата sha или md5, что исключает подмену или иную модификацию передаваемого трафика (чего не было у ssh версии 1).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Теперь пару слов о способах аутентификации пользователей через ssh:</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Times New Roman'; font-size:medium; color:#000000;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">По адресу клиента. При данном способе аутентификации происходит следующее: каждый клиент и сервер имеют свои пары ключей RSA, которые называются ключи хоста. При этом существует несколько методов проверки адреса клиента. Сервер смотрит файлы $HOME/.rhosts, $HOME/.shosts, /etc/hosts.equiv или /etc/ssh/shosts.equiv, если же сервер настроен на проверку ключей клиентов (а это нужно в соображениях безопасности, т.к. иначе злоумышленник может подменить ip клиента на свой), то он дополнительно проверяет /etc/ssh/ssh_known_hosts и $HOME/.ssh/known_hosts. Естественно, что файлы, расположенные в домашних каталогах сервера, действуют на пользователя, в чьем каталоге они размещены, а файлы, расположенные в /etc имеют глобальный эффект.</span></li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Для начала расскажу о синтаксисе вышеперечисленных файлов: - </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">.rhosts</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> - определяет адрес машины и имя пользователя, с которой данному пользователю открыт доступ (файл расположен в домашнем каталоге пользователя); - </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">.shosts</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">* - аналогичен .rhosts, но предназначен исключительно для ssh, поэтому использовать лучше именно данный файл; - </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">/etc/hosts.equiv</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> - также содержит пары имя машины/имя пользователя, но имеет эффект на всех пользователей; - </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">/etc/shosts.equiv</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">** - аналог hosts.equiv, но применяется только ssh, что также более предпочтительно. - </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">/etc/ssh/ssh_known_hosts</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">$HOME/.ssh/known_hosts</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">*** - данные файлы содержат список адресов и соответствующих им публичных ключей. При запросе клиента сервер генерирует рандомную строку и шифрует ее публичным ключом удаленного хоста. Клиент, получив данную строку, расшифровывает ее своим секретным ключом (который имеется только у него) и зашифровывает полученную строку ключом сервера. Сервер получает зашифрованное сообщение, расшифровывает своим секретным ключом и сравнивает с исходной. Если строки совпали, то клиент имеет валидный секретный ключ, что дает ему право захода на данный сервер. Но для начала клиент должен иметь правильный адрес, которому соответствует публичный ключ на сервере в файле ssh_known_hosts. Файл состоит из 3-х полей: адрес (или адреса, разделенные запятой), публичный ключ для него одной (!) строкой и дополнительное поле комментариев(необязательно);</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">* Пример </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">.shhosts</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> user1.test.ru user1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> userstend.test.ru user1</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> null.test.ru user1</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">** Пример файла </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">/etc/shhosts.equiv</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> + user1.test.ru user1</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> - server.test.ru xakep</span></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Знак &quot;+&quot; означает разрешение пользователю работать с сервером с данного адреса, знак &quot;-&quot; запрещает подобное действие.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">*** Пример файла known_hosts: </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">user1.test.ru {SOME_VERY_LONG_PUBLIC_KEY}</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> Адрес клиента должен быть в полном формате (name.domain), иначе могут быть проблемы. Кроме этого, в адресе можно использовать шаблоны * и ?. Публичные ключи вставляются в данный файл самим администратором из генерированных клиентом ssh(identity.pub) публичных ключей. Вообще создание ssh_known_hosts - это прерогатива администратора (aka root).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">И еще добавлю: при аутентификации по хосту лучше использовать ssh_known_hosts, т.к. этот метод достаточно безопасен, если публичные ключи клиентов были получены из доверенного источника. Другие методы аутентификации не исключают подмену адреса, и потому считаются небезопасными.</span></p>
<li style=" font-family:'Times New Roman'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Аутентификация пользователя по его публичному ключу.</span></li>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Аутентификация удаленного пользователя по ключу идентична проверке ключа хоста (с посылкой рандомной строки) за тем исключением, что проверяется не адрес клиентской машины, а ключ клиента и имя пользователя. Данному пользователю на сервере может соответствовать его публичный ключ, тогда клиент, имея секретный ключ сможет заходить на сервер без пароля. Механизм работы я только что описал, поэтому сразу же расскажу, каким образом аутентифицировать пользователей по ключу (предполагается, что используется клиент и сервер openssh):</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Для генерации пары ключей используйте программу ssh-keygen. Для указания типа ключа укажите </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-keygen -t {RSA DSA}</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, например, </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-keygen -t rsa</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> создаст пару ключей RSA длиной 1024 бита. Для указания файла, в котором следует сохранить ключи, можно использовать опцию </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">-f</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> (традиционно используются файлы </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">$HOME/.ssh/id_rsa</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> и</span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">$HOME/.ssh/id_dsa</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> для ключей rsa и dsa соответственно), для указания длины ключа в битах используйте опцию </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">-b</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-keygen -t rsa -b 2048 -f $HOME/.ssh/id_rsa</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">В результате работы программа запросит ввод пароля для шифрования секретного ключа, чтобы исключить использование его при попадании к посторонним лицам, не знающим пароля (пароль желательно выбирать не короче 10-и символов). После этого вам будет необходимо вводить данный пароль каждый раз при использовании секретного ключа (далее я расскажу, как избежать этого при помощи программы </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-agent</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">). После работы ssh-keygen создается пара ключей: один секретный (зашифрованный введенным паролем), а другой публичный с расширением .pub (id_rsa.pub). Публичный ключ вам необходимо будет скопировать в домашнюю директорию сервера</span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">$HOME/.ssh/authorized_keys</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">. После этого сервер будет знать ключ данного пользователя и сможет аутентифицировать вас без пароля. Файл </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">authorized_keys</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> может содержать несколько публичных ключей, допустимых для данного пользователя: просто поместите их в данный файл по порядку. После этих операций вы сможете входить, имея секретный ключ, на сервер, где размещен ваш публичный ключ, причем под тем пользователем, в чьем домашнем каталоге данный ключ находится. Пароля удаленного пользователя не требуется, необходимо только знать пароль расшифровки секретного ключа. Для переноса своего публичного ключа на сервер надо использовать только безопасные источники, иначе ваш ключ могут подменить. Для переноса публичного ключа клиента служит программа </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-copy-id</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">. Для начала необходимо сделать следующее:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># ssh-copy-id  -i public_key_file user@machine</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">После соединения с севером machine и передачей имени пользователя user (необходимо указывать, если удаленное имя отличается от локального) происходит парольная аутентификация заданного пользователя(или текущего) на удаленной машине, затем происходит копирование ключа </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">public_key_file</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> (или </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">$HOME/.ssh/identity.pub</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, если имя файла не указано) на сервер в </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">$HOME/.ssh/authorized_keys</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">. После этого можно входить на сервер, не используя пароль пользователя. При выполнении данной операции учтите, что вы должны скопировать на удаленную машину ПУБЛИЧНЫЙ ключ, иначе все будет очень печально (думаю, ясно, почему).</span></p>
<li style=" font-family:'Times New Roman'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Обычная парольная аутентификация.</span></li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Тут можно отметить только одно: в любом случае вначале идет обмен асимметрическими ключами, и хеш пароля передается в зашифрованном виде. Парольная аутентификация используется наиболее часто, но, честно говоря, ssh предлагает более удобные методы аутентификации, и пользоваться ими IMHO можно, если к ssh есть все заплатки. И, конечно же, протокол версии 1 необходимо вырубить вообще. Итак, начинаем настройку... Я заметил, что большинство администраторов просто оставляет конфиги клиента и сервера по умолчанию, чтобы руки не марать. Но это неправильно: в разных системах эти конфиги различаются очень существенно, и это приводит к неразберихе и непониманию работы сервера, что создает дополнительную угрозу безопасности (свой сервак - потемки). Для этого я решил описать файлы конфигурации ssh на примерах </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh_config</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">sshd.conf</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> для клиента и сервера соответственно. Для конфигурации клиента используется файл </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">$HOME/.ssh/config</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> или </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">/etc/ssh/ssh_config</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> (для всей системы). Файл имеет следующий формат: определение адреса хоста и параметры для него. В адресе можно использовать обычные шаблоны * и ?, все имена параметров и их значения должны быть набраны в том же регистре, что и в примере (иначе параметр воспринят не будет). Вот пример </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh_config</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, который содержит наиболее полезные опции (на самом деле описывать некоторые параметры конфигурации ssh не имеет смысла, т.к. употребляются они очень редко):</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Определение хоста, в данном случае включает все хосты домена test.ru, можно</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># использовать одиночный символ * чтобы указать параметры доступа к любому хосту</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Host *.test.ru</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Эта опция определяет, будет ли ssh использовать передачу данных от удаленного</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># X сервера через свой безопасный канал. Далее будет описано, каким образом</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># организуются безопасные туннели через ssh. Данная возможность позволяет</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># защищать по идее небезопасные протоколы(X, pop, smtp, ftp) шифрованием ssh. По</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># умолчанию данная опция no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ForwardX11 yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Список предпочтительных методов аутентификации через ssh версии 2. Первым</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># стоит самый предпочтительный протокол, думаю, значения данного параметра ясны</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PreferredAuthentications hostbased,publickey,keyboard-interactive</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Этот параметр определяет, будет ли производится стандартная парольная проверка</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># По умолчанию yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PasswordAuthentication yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Число попыток ввода пароля перед тем, как клиент отсоединяется от сервера. По</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># умолчанию пароль можно вводить трижды</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">NumberOfPasswordPrompts 3</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Список допустимых пользователей для данного сервера. Можно применять два</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># формата: список пользователей, разделенных пробелом, и список пользователей и</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># хостов, разделенных пробелом(USER@HOST - разрешает данному пользователю доступ</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># только с данного адреса). Можно использовать выражения * и ?. Подобное же</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># назначение имеют опции AllowGroups, DenyUsers и DenyGroups(для групп нельзя</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># указывать адрес клиента)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">AllowUsers *@*.test.ru</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">DenyUsers xakep lamer</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">DenyGroups x*</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Использование ssh(2 версия) аутентификации через rhosts и RSA ключи. По</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># умолчанию no.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">HostbasedAuthentication yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Будет ли клиент пытаться работать по rsh, если ssh недоступен или по каким-то</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># причинам работает неправильно. По умолчанию no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">FallBackToRsh no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Используем ли rsh. По умолчанию no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">UseRsh no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Режим скрипта, когда не спрашиваются пароли с терминала. По умолчанию no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">BatchMode no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Дополнительно проверяется ключ хоста удаленной машины в</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># known_hosts, что исключает подмену ip. По умолчанию yes.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">CheckHostIP yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Данный параметр означает, будет ли клиент доверять полученным от серверов</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># ключам. Параметр может принимать следующие значения: yes - ключи никогда</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># автоматически не помещаются в known_hosts, ask - ключ может быть помещен в</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># known_hosts только после подтверждения пользователя, no - все ключи</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># автоматически размещаются в known_hosts(небезопасно). По умолчанию ask.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">StrictHostKeyChecking ask</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Следующие параметры определяют секретные ключи ssh различных форматов:</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># rsa и dsa</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">IdentityFile $HOME/.ssh/id_rsa</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">IdentityFile $HOME/.ssh/id_dsa</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Порт, на удаленной машине используемый ssh. По умолчанию 22</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Port 22</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Версии протоколов, используемые клиентом в порядке убывания приоритета.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Protocol 2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Протокол шифрования для версии 1 протокола ssh</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Cipher 3des</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Возможные протоколы шифрования в порядке убывания приоритета для протокола</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># версии 2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Ciphers aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,arcfour,aes192-cbc,aes256-cbc</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Значение escape-символа, сигнализирующего, что идущие за ним символы</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># необходимо воспринимать специальным образом(например ~. вызовет немедленное</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># отключение клиента от сервера) при передаче двоичных данных необходимо</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># установить этот параметр в none, что выключает escape последовательности. По</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># умолчанию ~</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">EscapeChar ~</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Управление работой компрессии зашифрованнного трафика. Полезный параметр для</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># медленных сетей, т.к. зашифрованные данные обычно увеличиваются в размере за</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># счет фиксированной длины ключа. Компрессия позволяет уменьшить количество</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># данных, передаваемых через сеть, но увеличит время работы самого протокола.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Так что включать этот параметр желательно на медленных соединениях. По</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># умолчанию no.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Compression yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Управляет посылкой сообщений о доступности клиента серверу, что позволяет</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># нормально разорвать соединение, если произошла неполадка в сети или иная,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># приведшая к разрыва соединения. Если связь плохая, то лучше эту опцию</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># отключить, чтобы дисконнект не происходил после каждой ошибки сети. По</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># умолчанию yes.</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">KeepAlive yes</span></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Я думаю, что в данном примере все объяснено достаточно подробно и скажу только вот что: в большинстве случаев опции по умолчанию работают неплохо, необходимо только отключить поддержку ssh версии 1 и настроить необходимые методы аутентификации (кроме парольной) и указать пути доступа к ключам. На этом закончим с настройкой клиента и настроим сервер. Файл конфигурации сервера sshd находится в </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">/etc/ssh/sshd_config</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, и многие его параметры совпадают с аналогичными в </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh_config</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, но здесь нет определений хостов, как это было в</span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh_config</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">. Я все же приведу пример sshd_config, чтобы далее не возникало вопросов:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Номер порта и версия протокола</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Port 22</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Protocol 2</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier'; font-size:medium; color:#000000;"></pre>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Адреса, на которых слушает сервер, можно также указывать</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># порт (server.test.ru:2022), но назначение ssh нестандартного порта</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># нецелесообразно, т.к. заинтересует потенциальных взломщиков(&quot;А чего это там</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># они прячут?&quot;)</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ListenAddress server.test.ru</span></pre>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Ключ сервера для протокола версии 1</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">HostKey /etc/ssh/ssh_host_key</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Ключи rsa и dsa для ssh версии 2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">HostKey /etc/ssh/ssh_host_rsa_key</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">HostKey /etc/ssh/ssh_host_dsa_key</span></pre>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Данные значения определяют длину ключа сервера и его время жизни для</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># использования ssh версии 1(данный ключ будет заново генерироваться через</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># заданное время)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">#KeyRegenerationInterval 3600</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">#ServerKeyBits 768</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier'; font-size:medium; color:#000000;"></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier'; font-size:medium; color:#000000;"></pre>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Далее определяем методы аутентификации для данного сервера и ее параметры</span></pre>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Сервер отсоединяется по происшествии данного времени в секундах, если клиент</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># не проходит аутентификацию</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">LoginGraceTime 600</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Разрешаем заходить по ssh руту. Долгое время эта тема обсуждалась на форуме,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># но я думаю все же, что со внутренней сети рут может заходить и по ssh (для</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># этого надо настроить должным образом iptables). Также можно запретить руту</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># входить по паролю: without-password, разрешая вход только по публичному ключу</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PermitRootLogin yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Проверка sshd прав доступа и владельцев домашних каталогов. Полезно для тех</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># пользователей, что дают права всему 0777. Хотя таких болванов лучше держать на</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># расстоянии от сервера(лучше всего это делать бревном, подвешенным в серверной</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># к потолку, чтобы придать нежеланному гостю должное ускорение, и не забудьте</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># оббить конец бревна какой-нибудь железкой, иначе бревна придется менять</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># слишком часто ;)</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">StrictModes yes</span></pre>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Аутентификация через RSA (версия 1)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">RSAAuthentication yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Аутентификация пользователя по ключу (версия 2)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PubkeyAuthentication yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Определяет публичный ключ пользователя для аутентификации по ключу. Можно</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># применять шаблоны: %u - имя пользователя, %h - домашний каталог пользователя.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">AuthorizedKeysFile	.ssh/authorized_keys</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier'; font-size:medium; color:#000000;"></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Не используем аутентификацию rhosts</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">RhostsAuthentication no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Можно также игнорировать rhosts и shosts при hostbased autentification,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># используя только known_hosts файл.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">#IgnoreRhosts yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Используем ли аутентификацию через known_hosts совместно с .rhosts или</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># .shosts. Опция действительна только для протокола версии 1.</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">RhostsRSAAuthentication no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># То же самое, что и предыдущее только для версии 2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">HostbasedAuthentication yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Если нет доверия к known_hosts, то их можно не использовать при hostbased</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># autentification. По умолчанию no</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">IgnoreUserKnownHosts no</span></pre>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Чтобы запретить посылку хешей паролей через туннель ssh задайте значение</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># данной опции no. По умолчанию аутентификация по паролю разрешена</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PasswordAuthentication yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Можно также разрешить пустые пароли, но это полный отстой, т.к. это огромная</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># дыра на сервере, через которую можно наделать много гадостей! Поэтому должно</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># быть no (по умолчанию)</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PermitEmptyPasswords no</span></pre>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Аутентификация через механизм PAM.</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PAMAuthenticationViaKbdInt no</span></pre>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Передача протокола иксов через туннель ssh</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">X11Forwarding yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Используем в качестве x-сервера данный, т.е. клиент, запуская у себя x-клиента</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># будет фактически использовать наш сервер, но все данные от сервера к клиенту</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># будут шифроваться, что есть хорошо!</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">X11UseLocalhost yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># При логине пользователя выводим /etc/motd: в некоторых системах это отменено в</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># целях безопасности</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PrintMotd yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Сообщаем пользователю время и место последнего логина, ситуация, аналогичная</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># предыдущей</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PrintLastLog yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Посылать клиенту сообщения о доступности</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">KeepAlive yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Максимальное число возможных соединений, где не произошло аутентификации. Если</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># клиентов, не прошедших аутентификацию больше, то новые соединения не будут</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># обрабатываться</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">MaxStartups 10</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Путь к файлу, который будет отображаться при входе клиента ДО аутентификации</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Banner /etc/ssh_message</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Проверка соответствия ip адреса клиента и его символического имени в backzone,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># затем снова сравнение имени с ip адресом. Таким образом (извращенным)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># проверяется подлинность ip, но метод этот достаточно тормозной и по умолчанию</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># он отключен</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">VerifyReverseMapping no</span></pre>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># Новые системы, работающие через ssh. В данном примере определяется</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># &quot;безопасный&quot; ftp сервер - sftp, аналогичный доступ пользователя, но с</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># возможностью передачи файлов(т.е. пользователь получает доступ ко всем своим</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># файлам и нет возможности настройки разрешений и виртуальных пользователей,</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># как, например в proftpd). По сути дела подсистемы ssh могут обеспечивать</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># прохождение других протоколов по сети, но под &quot;крылышком&quot; ssh. Например, для</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># sftp сервера есть одноименный sftp клиент. Его интерфейс полностью идентичен</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># оригинальному ftp, но с одним отличием: происходит та же самая аутентификация</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># пользователя на удаленном сервере(методами ssh), но вместо оболочки с</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># пользователем взаимодействует подсистема, в данном случае sftp.</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Subsystem	sftp	/usr/lib/ssh/sftp-server</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Ну вот, вроде бы все настроено! Теперь я бы хотел поговорить о некоторых фичах, работающих в ssh. Для начала я бы хотел рассказать о туннелях. SSH имеет встроенную возможность передавать данные с локального порта на удаленный, используя сетевой туннель, причем данные, передаваемые через данный туннель будут шифроваться. То есть происходит аутентификация на удаленной системе, а затем начинается перенаправление трафика через туннель. Таким образом, можно перенаправлять любой трафик, а протокол иксов может работать в интерактивном режиме, для этого необходимо включить соответствующие опции в файлах конфигурации сервера и клиента(это было описано ранее). Для других же портов необходимо вызывать ssh с параметром </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">-L{LOCAL_PORT}:{LOCAL_ADDRESS}:{REMOTE_PORT}</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># ssh -L10101:localhost:101 server.test.ru</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Такой туннель довольно быстро умирает, т.к. сервер автоматически убивает &quot;ленивых&quot; клиентов. Поэтому можно применить метод, который позволяет устанавливать произвольное время удержания туннеля: выполнить sleep на удаленном сервере:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># ssh -f -L10101:loclahost:101 server.test.ru sleep 100</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Данная команда держит туннель 100 секунд, чего достаточно для любого соединения. И еще одна вещь: когда по туннелю передаются данные, то он не уничтожается, что хорошо для реализации безопасного ftp-, smtp- и pop3-протоколов (впрочем, sftp-сервер имеется уже и в поставке openssh, применение его не должно вызвать затруднений sftp [user@]hostname, т.к. фактически это особая реализация ssh протокола и механизм работы sftp абсолютно идентичен механизму ssh). Чтобы отключить перенаправление портов, необходимо установить опцию sshd</span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">AllowTcpForwarding</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> в </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">no</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">. Использование длительной задержки ssh-туннеля несколько уменьшает безопасность, т.к. во время ожидания злоумышленник имеет больше шансов на атаку (но механизм ssh версии 2 позволяет избежать подобной ситуации подписыванием передаваемых сообщений).</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Вот что сделал бы я для безопасного ssh. Для начала создал бы rsa-ключ длиной 4096 бит:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># ssh-keygen -t rsa -b 4096</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Затем скопировал бы данный ключ с помощью флешки или ssh-copy-id на удаленный сервер(а):</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># ssh-copy-id -i $HOME/.ssh/id_rsa remote_host</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">После этого запретил бы парольную и всякую host-based аутентификацию в </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">sshd_config</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> IgnoreHosts yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> RhostsAuthentication no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> RhostsRSAAuthentication no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> RSAAuthentication yes</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> HostbasedAutentification no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> PasswordAuthentication no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> PermitEmptyPasswords no</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> UseLogin no</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"> PermitRootLogin without-password</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">И отключим потокол версии 1 (по умолчанию Protocol 2,1 и сервер падает к ssh 1, при неудаче ssh 2):</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Protocol 2</span></pre>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Ну, вот, теперь, чтобы зайти на сервак по ssh надо ввести нехилый (а он должен быть нехилый!) пароль секретного ключа. Немножко неудобно, не правда ли? Можно хранить пароль для секретного ключа в памяти на протяжении работы некоторой программы (например, bash) и при запросе его ssh клиентом доставать из памяти. Для этой цели служит программа </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-agent</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> (агент аутентификации ssh). Агент запускает необходимую программу и ждет добавления новых секретных ключей (</span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-agent</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> хранит расшифрованные секретные ключи). Для этой цели есть другая программа - </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-add</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, которая добавляет в агент ключи </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">$HOME/.ssh/id_rsa</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">id_dsa</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">identity</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">. Если необходимо добавить другие ключи, то надо запустить </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-add</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> с именем файла: </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-add filename</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">. Учтите, что при добавлении ключа в агент </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-add</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> вам все равно необходимо ввести пароль для его расшифровки, но пока агент находится в памяти (пока вызванная им программа не завершилась), вводить пароль секретного ключа не надо: ключ берется из </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-agent</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">. Причем контакт с </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">ssh-agent</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> может устанавливать только программа, запущенная им (и все ее дочерние процессы), т.к. устанавливаются переменные окружения. Обычный метод запуска ssh-agent:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># ssh-agent bash</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;"># ssh-add</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Enter passphrase for '.ssh/id_rsa':</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">Enter passphrase for '.ssh/id_dsa':</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">.ssh/identity : No such file or directory</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">После завершения работы оболочки ssh-agent завершается, а ключи удаляются из памяти. Ну, и наконец можно разрешить доступ определенных пользователей с определенных машин. Это делается полем </span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">AllowUsers</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> в</span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">sshd_config</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;"> или правилами iptables. Думаю, этого достаточно для нормальной и безопасной работы на удаленном сервере через ssh. Особо мнительные могут запретить доступ рута по ssh (</span><span style=" font-family:'Courier New,courier'; font-size:medium; color:#000000;">PermitRootLogin no</span><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">) и делегировать часть его прав с помощью sudo. Ну, и использовать протокол версии 2 (такие плюсы, как алгоритм вычисления симметрического ключа на основании пары асимметрических, и подписывание сообщений, передаваемых по сети, а также 2 версия протокола ssh быстрее первой). Существует множество клиентов ssh, работающих на разных ОС. Для Windows выделю </span><a href="http://www.chiark.greenend.org.uk/~sgtatham/putty.html"><span style=" font-family:'Times New Roman'; font-size:medium; text-decoration: underline; color:#000000;">putty</span></a><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, а для Mac - </span><a href="http://www.lysator.liu.se/~jonasw/freeware/niftyssh/"><span style=" font-family:'Times New Roman'; font-size:medium; text-decoration: underline; color:#000000;">NiftyTelnet 1.1 SSH</span></a><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">Хороший список ссылок по ssh находится на </span><a href="http://www.heimhardt.com/"><span style=" font-family:'Times New Roman'; font-size:medium; text-decoration: underline; color:#000000;">www.heimhardt.com</span></a><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, полезным мне показался также сайт </span><a href="http://www.openssh.com/"><span style=" font-family:'Times New Roman'; font-size:medium; text-decoration: underline; color:#000000;">www.openssh.com</span></a><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">, ну, и есть документация по ssh (правда, версии 1) на сайте </span><a href="http://www.opennet.ru/"><span style=" font-family:'Times New Roman'; font-size:medium; text-decoration: underline; color:#000000;">www.opennet.ru</span></a><span style=" font-family:'Times New Roman'; font-size:medium; color:#000000;">.</span></p></body></html>