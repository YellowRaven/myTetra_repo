<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:10pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:16px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-size:x-large; color:#333333;">Impressive Solids: делаем игру на C# под OpenGL, часть I</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Verdana,sans-serif'; font-size:large; color:#999999;">Once Upon a Time in America</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br />Когда-то, году в 2002-м, на мой компьютер попала интересная игрушка под названием Amazing Blocks. Игра, так сказать, класса тетриса (подробное описание геймплея приведено ниже); она очень полюбилась моей маме, которая играла в эту игру часами. Однако был досадный недостаток: после, кажется, 10 запусков игра начинала требовать регистрацию, которая, что удивительно, была бесплатной, но через интернет, что, само собой, являлось непреодолимым препятствием, поскольку интернета-то никакого тогда в наших краях в глаза не видывали, хоть и слыхали, что есть такая штука. Приходилось постоянно переустанавливать.<br /><br />Через года три, когда интернет уже провели, а игра успела стать shareware и начать просить за регистрацию сколько-то денег, я попробовал её зарегистрировать, однако сайт производителя был к тому времени скорее мёртв, чем жив, и, по-видимому, остаётся таким и по сей день. В интернете легко находится shareware-версия игры, множество, не побоюсь этого слова, кейгенов, являющихся на самом деле троянами, и ни одной возможности зарегистрировать игру, чтобы мама могла в неё играть уже совсем на другом компьютере. В какой-то момент я подумал: а почему бы просто самому не сделать аналогичную игру и решить тем самым проблему на корню? Заодно из этого может получится какой-никакой hello-world по разработке простой игры для ПК в современных условиях — который я и предлагаю вниманию читателей.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Verdana,sans-serif'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image17172.png" /></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Verdana,sans-serif'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="http://besisland.name/img/blog/impressive-solids-habr-1.png" style="float: left;" /><span style=" font-family:'Verdana,sans-serif'; color:#000000;">Итак, что же за игру мы будем делать? Суть такова. В прямоугольном стакане 7×13 падает горизонтальная палка, состоящая из 3 цветных блоков (всего есть 5 цветов). Во время движения её можно двигать вправо-влево, а также менять блоки местами в порядке ротации справа налево (красный, зелёный, синий → зелёный, синий, красный). Как только палка коснётся пола стакана или же какого-нибудь из находящихся в стакане неподвижных блоков, ею больше управлять нельзя. Блоки, составляющие палку, продолжают падение отдельно до тех пор, пока не станут на неподвижный блок или пол стакана. После этого проверяется, не получилась ли в стакане горизонтальная, вертикальная или диагональная линия из трёх или более блоков одного цвета; такие линии уничтожаются. Если сверху уничтоженной линии были блоки, они сползают вниз на образовавшееся пустое место, после этого снова происходит уничтожение образовавшихся линий. Когда всё устаканилось, сверху начинает падать новая палка. За выстраивание уничтожаемых линий игрок получает очки. Игра заканчивается, когда стакан заполнен доверху.<br /><br />Технологии. Игру будем делать на C# (давно хотел посмотреть, что же это такое), OpenGL (DirectX работает только под Windows, а я больше люблю Linux), Mercurial для контроля версий (писать код без VCS — неуважение к себе).<br /><br />Игра будет называться Impressive Solids.<br /><br /></span><a name="habracut"></a><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:large; color:#999999;">Inception</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br />Разработку под Windows будем вести в </span><a href="http://www.microsoft.com/visualstudio/en-us/products/2010-editions/visual-csharp-express"><span style=" font-family:'Verdana,sans-serif'; text-decoration: underline; color:#6da3bd;">Microsoft Visual C# 2010 Express</span></a><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> (распространяется бесплатно). Также нам понадобится </span><a href="http://tortoisehg.bitbucket.org/"><span style=" font-family:'Verdana,sans-serif'; text-decoration: underline; color:#6da3bd;">TortoiseHg</span></a><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> — Windows-клиент системы контроля версий Mercurial. Под системы на базе Linux будем использовать MonoDevelop и консольный hg.<br /><br />Для подключения OpenGL задействуем binding </span><a href="http://www.opentk.com/"><span style=" font-family:'Verdana,sans-serif'; text-decoration: underline; color:#6da3bd;">OpenTK</span></a><span style=" font-family:'Verdana,sans-serif'; color:#000000;">. Нужно скачать свежий </span><a href="http://sourceforge.net/projects/opentk/files/opentk/nightly/"><span style=" font-family:'Verdana,sans-serif'; text-decoration: underline; color:#6da3bd;">nightly build</span></a><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> (на момент написания статьи: 2011-12-03).<br /><br />Создаём в Visual C# Express новый empty project под названием ImpressiveSolids. Сохраняем. Затем открываем директорию с проектом, вызываем для неё контекстное меню и выбираем TortoiseHg → Create Repository Here. Отмечаем пункты создания файла .hgignore и открытия workbench после инициализации.<br /><br />Открываем в Visual C# Express файл .hgignore и записываем в него следующие строки. Это нужно для того, чтобы система контроля версий не учитывала ненужные бинарные файлы.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    syntax: glob</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    *.suo</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    *.pidb</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    ImpressiveSolids/bin/*</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    ImpressiveSolids/obj/*</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />Внутри директории solution (не проекта; там, где лежит .hgignore) создаём поддиректорию OpenTK и копируем в неё файлы OpenTK*.dll и OpenTK*.dll.config из директории opentk\Binaries\OpenTK\Release\ в архиве OpenTK.<br /><br />В Visual C# Express контекстное меню References → Add Reference → Browse. Выбираем ../OpenTK/OpenTK.dll. Кроме того, нужно добавить reference на System.Drawing с вкладки .NET.<br /><br />Создаём новый класс </span><span style=" font-family:'monospace'; color:#000000;">Game</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;">. Это главный класс программы, в нём находится точка входа, а сам он — наследник </span><span style=" font-family:'monospace'; color:#000000;">OpenTK.GameWindow</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> и отвечает за обновление состояния игры (</span><span style=" font-family:'monospace'; color:#000000;">OnUpdateFrame</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;">) и перерисовку (</span><span style=" font-family:'monospace'; color:#000000;">OnRenderFrame</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;">). Сейчас это будет просто чёрное окно.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">using</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> System;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">using</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OpenTK;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">using</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OpenTK.Graphics;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">using</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OpenTK.Graphics.OpenGL;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">namespace</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ImpressiveSolids {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">class</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Game : GameWindow {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            [STAThread]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">static</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Main() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">using</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Game = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Game()) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    Game.Run(</span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">30</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">public</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Game()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                : </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">(</span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">700</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">500</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">, GraphicsMode.Default, </span><span style=" font-family:'monospace'; color:#339900; background-color:#f8f8f8;">&quot;Impressive Solids&quot;</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                VSync = VSyncMode.On;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnLoad(EventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnLoad(E);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnResize(EventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnResize(E);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GL.Viewport(ClientRectangle.X, ClientRectangle.Y, ClientRectangle.Width, ClientRectangle.Height);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnUpdateFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnUpdateFrame(E);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnRenderFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnRenderFrame(E);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GL.ClearColor(Color4.Black);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GL.Clear(ClearBufferMask.ColorBufferBit | ClearBufferMask.DepthBufferBit);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                SwapBuffers();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />Заходим в свойства проекта (Project → ImpressiveSolids Properties) и указываем Target framework: .NET Framework 2.0; Output type: Windows Application; Startup object: ImpressiveSolids.Game.<br /><br />Можно сохранять и запускать, должно появиться чёрное окно размером 700×500 с заголовком «Impressive Solids».<br /><br />Если всё прошло гладко, идём в TortoiseHg Workbench и коммитим всё с пометкой «Initial game window».<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:large; color:#999999;">The Fall</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br />Реализуем управляемое падение палки. Для этого прежде всего нужно задать модель текущего состояния палки. Во-первых, позиция. По умолчанию — сверху по центру стакана. Будем считать, что (0; 0) соответствует верхнему левому углу стакана. Нужно, кстати, задать его размеры </span><span style=" font-family:'monospace'; color:#000000;">MapWidth</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;">, </span><span style=" font-family:'monospace'; color:#000000;">MapHeight</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;">. Цвета блоков, составляющих палку, будем хранить как массив целых чисел; зададим количество возможных цветов </span><span style=" font-family:'monospace'; color:#000000;">ColorsCount</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> и договоримся, что цвет обозначается целочисленным значением от </span><span style=" font-family:'monospace'; color:#000000;">0</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> до </span><span style=" font-family:'monospace'; color:#000000;">ColorsCount − 1</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;">.<br /><br />Добавим в класс Game метод New и вызовем его из OnLoad. В этом методе реализуем построение палки из блоков случайных цветов.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Random Rand;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">const</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> MapWidth = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">7</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">const</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> MapHeight = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">13</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">const</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> StickLength = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">3</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">[] StickColors;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Vector2 StickPosition;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">const</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ColorsCount = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">5</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnLoad(EventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnLoad(E);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        New();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> New() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        Rand = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Random();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        StickColors = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">[StickLength];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            StickColors[i] = Rand.Next(ColorsCount);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        StickPosition.X = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)Math.Floor((MapWidth - StickLength) / </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">2</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">d);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        StickPosition.Y = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />Попробуем отобразить нашу палку на экране, пока в самом примитивном варианте (блок изображаем цветным прямоугольником, стакан начинаем прямо в верхнем левом углу окна). Внесём в код некоторые изменения.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">const</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> NominalWidth = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">700</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">const</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> NominalHeight = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">500</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ProjectionWidth;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ProjectionHeight;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">const</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> SolidSize = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">35</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Color4[] Colors = {Color4.PaleVioletRed, Color4.LightSeaGreen, Color4.CornflowerBlue, Color4.RosyBrown, Color4.LightGoldenrodYellow};</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">public</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Game()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        : </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">(NominalWidth, NominalHeight, GraphicsMode.Default, </span><span style=" font-family:'monospace'; color:#339900; background-color:#f8f8f8;">&quot;Impressive Solids&quot;</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        VSync = VSyncMode.On;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnResize(EventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnResize(E);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Viewport(ClientRectangle.X, ClientRectangle.Y, ClientRectangle.Width, ClientRectangle.Height);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        ProjectionWidth = NominalWidth;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        ProjectionHeight = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)ClientRectangle.Height / (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)ClientRectangle.Width * ProjectionWidth;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (ProjectionHeight &lt; NominalHeight) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            ProjectionHeight = NominalHeight;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            ProjectionWidth = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)ClientRectangle.Width / (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)ClientRectangle.Height * ProjectionHeight;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnRenderFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnRenderFrame(E);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.ClearColor(Color4.Black);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Clear(ClearBufferMask.ColorBufferBit | ClearBufferMask.DepthBufferBit);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Projection = Matrix4.CreateOrthographic(-ProjectionWidth, -ProjectionHeight, -</span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.MatrixMode(MatrixMode.Projection);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.LoadMatrix(</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">ref</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Projection);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Translate(ProjectionWidth / </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">2</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">, -ProjectionHeight / </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">2</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Modelview = Matrix4.LookAt(Vector3.Zero, Vector3.UnitZ, Vector3.UnitY);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.MatrixMode(MatrixMode.Modelview);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.LoadMatrix(</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">ref</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Modelview);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Begin(BeginMode.Quads);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            RenderSolid(StickPosition.X + i, StickPosition.Y, StickColors[i]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.End();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        SwapBuffers();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> RenderSolid(</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X, </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y, </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Color) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Color4(Colors[Color]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Vertex2(X * SolidSize, Y * SolidSize);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Vertex2((X + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) * SolidSize, Y * SolidSize);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Vertex2((X + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) * SolidSize, (Y + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) * SolidSize);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Vertex2(X * SolidSize, (Y + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) * SolidSize);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />Ухищрения с </span><span style=" font-family:'monospace'; color:#000000;">Nominal/Projection Width/Height</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> понадобились для того, чтобы изображение масштабировалось при изменении размеров окна, но в то же время пропорции не искажались.<br /><br />Теперь сделаем наконец, чтобы палка падала и чтобы работали клавиши ←, →, ↑ (ротация цветов).<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">public</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Game()</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        : </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">(NominalWidth, NominalHeight, GraphicsMode.Default, </span><span style=" font-family:'monospace'; color:#339900; background-color:#f8f8f8;">&quot;Impressive Solids&quot;</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        VSync = VSyncMode.On;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        Keyboard.KeyDown += </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> EventHandler&lt;KeyboardKeyEventArgs&gt;(OnKeyDown);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnUpdateFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnUpdateFrame(E);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        StickPosition.Y += </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0.02</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">f;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnKeyDown(</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">object</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Sender, KeyboardKeyEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Key.Left == E.Key) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            --StickPosition.X;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Key.Right == E.Key) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            ++StickPosition.X;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Key.Up == E.Key) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> T = StickColors[</span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength - </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                StickColors[i] = StickColors[i + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            StickColors[StickLength - </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">] = T;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />Коммитим все изменения: «The stick, falling and controllable».<br /><br />Как видим, пока нет проверки на выход за границы стакана. Исправим это упущение в дальнейшем.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:large; color:#999999;">A Map of the World</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br />Займёмся ситуацией, когда палка опустилась на пол или на уже присутствующие в стакане блоки. Пока не будем разбираться с последующим неконтролируемым падением блоков и уничтожением линий, а сделаем просто, чтобы составляющие палку блоки застывали на месте (даже повисая в воздухе) и начинала падать следующая палка.<br /><br />Смоделируем состояние стакана в виде двумерного массива целых чисел. Координаты будут соответствовать клетчатой сетке стакана, значениями будет цвет блока в данной клетке — или отрицательное число, если в клетке пусто.<br /><br />Здесь уже будет необходимо ввести проверку на выход палки за границы стакана, иначе возникнут обращения к массиву по несуществующим индексам.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">[,] Map;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> New() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        Rand = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Random();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        Map = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">[MapWidth, MapHeight];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; X &lt; MapWidth; X++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; Y &lt; MapHeight; Y++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                Map[X, Y] = -</span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        StickColors = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">[StickLength];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GenerateNextStick();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> GenerateNextStick() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            StickColors[i] = Rand.Next(ColorsCount);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        StickPosition.X = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)Math.Floor((MapWidth - StickLength) / </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">2</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">d);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        StickPosition.Y = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnUpdateFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnUpdateFrame(E);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        StickPosition.Y += </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0.02</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">f;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> FellOnFloor = (StickPosition.Y &gt;= MapHeight - </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> FellOnBlock = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">false</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (!FellOnFloor) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)Math.Floor(StickPosition.Y + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)StickPosition.X + i;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Map[X, Y] &gt;= </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    FellOnBlock = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">true</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">break</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (FellOnFloor || FellOnBlock) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)Math.Floor(StickPosition.Y);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)StickPosition.X + i;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                Map[X, Y] = StickColors[i];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            GenerateNextStick();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnKeyDown(</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">object</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Sender, KeyboardKeyEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ((Key.Left == E.Key) &amp;&amp; (StickPosition.X &gt; </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            --StickPosition.X;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ((Key.Right == E.Key) &amp;&amp; (StickPosition.X + StickLength &lt; MapWidth)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            ++StickPosition.X;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Key.Up == E.Key) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnRenderFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#808080;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Begin(BeginMode.Quads);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; X &lt; MapWidth; X++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; Y &lt; MapHeight; Y++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Map[X, Y] &gt;= </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    RenderSolid(X, Y, Map[X, Y]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            RenderSolid(StickPosition.X + i, StickPosition.Y, StickColors[i]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.End();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        SwapBuffers();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />Теперь можно быстро набросать блоков до самого верха, как в старом добром «Тетрисе». Для тестирования можно увеличить скорость падения, заменив </span><span style=" font-family:'monospace'; color:#000000;">0.02f</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> на </span><span style=" font-family:'monospace'; color:#000000;">0.2f</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;">, а вообще надо будет сделать возможность ускорения по нажатию клавиши ↓.<br /><br />Не забываем коммитить изменения в репозиторий Mercurial: «Fixing blocks after the stick fell».<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:large; color:#999999;">Double Impact</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br />Следующее, что нам нужно сделать — это чтобы блоки не зависали в воздухе, а продолжали падать вниз, пока не упрутся. В этот период времени палки на экране нет, управлять ничем нельзя. В связи с этим введём в игру понятие состояния.<br /><br />Игра в каждый момент времени находится в одном из следующих состояний:<br /></span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:24px; margin-bottom:0px; margin-left:48px; margin-right:16px; -qt-block-indent:0; text-indent:0px;">Падает очередная палка, ею можно управлять. Когда начинается новая игра, включается это состояние.</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:48px; margin-right:16px; -qt-block-indent:0; text-indent:0px;">Неуправляемое падение блоков, уничтожение выстроившихся линий. Это состояние включается после того, как палка коснулась какого-нибудь блока. Заканчивается тогда, когда все блоки стоят неподвижно и уничтожимых линий нет. Если весь верхний ряд стакана свободен, то игра продолжается в состоянии № 1; иначе игра завершается (состояние № 3).</li>
<li style=" font-family:'Verdana,sans-serif'; color:#000000;" style=" margin-top:0px; margin-bottom:24px; margin-left:48px; margin-right:16px; -qt-block-indent:0; text-indent:0px;">Игра окончена, ничего не происходит. Игрок может начать новую игру (скажем, нажав некую кнопку).</li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br />Сделаем соответствующие объявления в коде.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">enum</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> GameStateEnum {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        Fall,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        Impact,</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GameOver</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> GameStateEnum GameState;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> New() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GenerateNextStick();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GameState = GameStateEnum.Fall;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnUpdateFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnUpdateFrame(E);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameStateEnum.Fall == GameState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            StickPosition.Y += </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0.2</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">f;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#808080;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (FellOnFloor || FellOnBlock) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)Math.Floor(StickPosition.Y);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X = (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)StickPosition.X + i;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    Map[X, Y] = StickColors[i];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GameState = GameStateEnum.Impact;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameStateEnum.Impact == GameState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Stabilized = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">true</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// TODO падение блоков</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#808080;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Stabilized) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GenerateNextStick();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GameState = GameStateEnum.Fall;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />Чтобы изобразить плавное падение блоков и не усложнять при этом модель стакана (</span><span style=" font-family:'monospace'; color:#000000;">Map</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;">), прибегнем к хитрости. Пусть блок, который падает из клетки (X; Y) в клетку (X; Y + 1) — а куда ещё ему падать? — числится в клетке (X; Y) вплоть до момента окончательного попадания в нижнюю клетку; а дополнительно будем хранить дробное смещение блока по вертикали, которое будет постепенно увеличиваться, пока не превысит единицу. Т. е. реальные координаты блока будут не (X; Y), а (X; Y + Δ), это надо будет учесть в </span><span style=" font-family:'monospace'; color:#000000;">OnRenderFrame</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;">.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">const</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> FallSpeed = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0.2</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">f;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">[,] ImpactFallOffset;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> New() {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        ImpactFallOffset = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">float</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">[MapWidth, MapHeight];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnUpdateFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">base</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">.OnUpdateFrame(E);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameStateEnum.Fall == GameState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            StickPosition.Y += FallSpeed;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameStateEnum.Impact == GameState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Stabilized = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">true</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; X &lt; MapWidth; X++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y = MapHeight - </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">2</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; Y &gt;= </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; Y--) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ((Map[X, Y] &gt;= </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) &amp;&amp; ((Map[X, Y + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">] &lt; </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) || (ImpactFallOffset[X, Y + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">] &gt; </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">))) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        Stabilized = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">false</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        ImpactFallOffset[X, Y] += FallSpeed;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (ImpactFallOffset[X, Y] &gt;= </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                            Map[X, Y + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">] = Map[X, Y];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                            Map[X, Y] = -</span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                            ImpactFallOffset[X, Y] = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Stabilized) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GenerateNextStick();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GameState = GameStateEnum.Fall;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnRenderFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#808080;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.Begin(BeginMode.Quads);</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; X &lt; MapWidth; X++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; Y &lt; MapHeight; Y++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Map[X, Y] &gt;= </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    RenderSolid(X, Y + ImpactFallOffset[X, Y], Map[X, Y]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameStateEnum.Fall == GameState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                RenderSolid(StickPosition.X + i, StickPosition.Y, StickColors[i]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        GL.End();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        SwapBuffers();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />Чтобы падать могла сразу целая колонна из блоков, под которыми образовалась дырка, клетки карты перебираем снизу вверх (нижний блок увлекает за собой верхний) и учитываем не только пустоту клетки, но и статус </span><span style=" font-family:'monospace'; color:#000000;">ImpactFallOffset</span><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> (потому что положительное число означает, что этот блок падает вниз).<br /><br />Коммитим с пометкой: «Blocks fall on impact until stabilized».<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:large; color:#999999;">Weapon of Mass Destruction</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br />Пришла пора наконец заняться основным элементом геймплея: уничтожением выстроенных линий одного цвета. Зададим минимальную длину линии. Достаточно пройти по всем клеткам, в которых есть блоки, и от каждой попытаться построить линию в одном из четырёх возможных направлений (горизонталь, вертикаль и две диагонали). Если обнаружена линия одного цвета достаточной длины, каждый составляющий её блок заносим в стек. После того, как проверена вся карта, уничтожаем все блоки, занесённые в стек, и помечаем положение как нестабильное.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">const</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> DestroyableLength = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">3</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Stack&lt;Vector2&gt; Destroyables = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Stack&lt;Vector2&gt;();</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnUpdateFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameStateEnum.Impact == GameState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Stabilized) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                Destroyables.Clear();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; X &lt; MapWidth; X++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; Y &lt; MapHeight; Y++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        CheckDestroyableLine(X, Y, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        CheckDestroyableLine(X, Y, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        CheckDestroyableLine(X, Y, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        CheckDestroyableLine(X, Y, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">, -</span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Destroyables.Count &gt; </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">foreach</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Coords </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">in</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Destroyables) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        Map[(</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)Coords.X, (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)Coords.Y] = -</span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    Stabilized = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">false</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Stabilized) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GenerateNextStick();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                GameState = GameStateEnum.Fall;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">private</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> CheckDestroyableLine(</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X1, </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Y1, </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> DeltaX, </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> DeltaY) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Map[X1, Y1] &lt; </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">return</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">int</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X2 = X1, Y2 = Y1;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> LineLength = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">while</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ((X2 &gt;= </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) &amp;&amp; (Y2 &gt;= </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) &amp;&amp; (X2 &lt; MapWidth) &amp;&amp; (Y2 &lt; MapHeight) &amp;&amp; (Map[X2, Y2] == Map[X1, Y1])) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            ++LineLength;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            X2 += DeltaX;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            Y2 += DeltaY;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (LineLength &gt;= DestroyableLength) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; LineLength; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                Destroyables.Push(</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">new</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Vector2(X1 + i * DeltaX, Y1 + i * DeltaY));</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />В репозитории помечаем: «Destroying lines of same color».<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; font-size:large; color:#999999;">Game Over</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br />Вы, вероятно, заметили забавное поведение игры при достижении верха стакана: вверху начинают мигать разными цветами, сменяя друг друга, бесконечно появляющиеся и тут же застывающие палки. Давайте обработаем ситуацию проигрыша: ничего не будет происходить, пока пользователь не нажмёт клавишу Enter.<br /><br />Здесь всё просто.<br /><br /></span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">override</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnUpdateFrame(FrameEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameStateEnum.Impact == GameState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#808080; background-color:#f8f8f8;">// . . .</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Stabilized) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> GameOver = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">false</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> X = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; X &lt; MapWidth; X++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Map[X, </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">] &gt;= </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        GameOver = </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">true</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">break</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameOver) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    GameState = GameStateEnum.GameOver;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    GenerateNextStick();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    GameState = GameStateEnum.Fall;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">protected</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">void</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> OnKeyDown(</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">object</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> Sender, KeyboardKeyEventArgs E) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameStateEnum.Fall == GameState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ((Key.Left == E.Key) &amp;&amp; (StickPosition.X &gt; </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                --StickPosition.X;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ((Key.Right == E.Key) &amp;&amp; (StickPosition.X + StickLength &lt; MapWidth)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                ++StickPosition.X;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (Key.Up == E.Key) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> T = StickColors[</span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">for</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (</span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">var</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> i = </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">0</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i &lt; StickLength - </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">; i++) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                    StickColors[i] = StickColors[i + </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">];</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                StickColors[StickLength - </span><span style=" font-family:'monospace'; color:#2f98ff; background-color:#f8f8f8;">1</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">] = T;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        } </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">else</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> (GameStateEnum.GameOver == GameState) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            </span><span style=" font-family:'monospace'; color:#4d7386; background-color:#f8f8f8;">if</span><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;"> ((Key.Enter == E.Key) || (Key.KeypadEnter == E.Key)) {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">                New();</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">            }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">        }</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; color:#000000; background-color:#f8f8f8;">    }</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; color:#000000;"></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,sans-serif'; color:#000000;"><br /><br />Коммитим, без лишних размышлений подписав: «Game over».<br /><br />На этом первая часть разработки закончена. У нас на руках — вполне полнофункциональная игра, в которую уже сейчас можно играть. Во </span><a href="http://habrahabr.ru/blogs/gdev/134283/"><span style=" font-family:'Verdana,sans-serif'; text-decoration: underline; color:#6da3bd;">второй части</span></a><span style=" font-family:'Verdana,sans-serif'; color:#000000;"> мы займёмся оформлением. Наложим текстуры, будем показывать текущий счёт, рекордный счёт; палку, которая выпадет следующей. Отцентрируем наконец изображение стакана в окне игры, изобразим его границы. В общем, доведём всё до ума.<br /><br />Проект доступен на </span><a href="http://code.google.com/p/impressive-solids/"><span style=" font-family:'Verdana,sans-serif'; text-decoration: underline; color:#6da3bd;">Google Project Hosting</span></a><span style=" font-family:'Verdana,sans-serif'; color:#000000;">, там можно посмотреть итоговый исходный код, скачать архив с готовым к запуску исполняемым файлом.</span></p></body></html>